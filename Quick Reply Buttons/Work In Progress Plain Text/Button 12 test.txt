/setvar key=catgen "Spells and Abilities"|
/setvar key=genid "12"|


//setvar key=swipe Yes|

/:"Character Maker V4.Get Char info"|




/setvar key=genState Redo|
/setvar key=outputString {{noop}}|

/while left=genState right=Redo rule=eq {:
	/echo Generating Spells|
    /setvar key=genState []|  
	
	/setvar key=system {{noop}}|
	/setvar key=prompt {{noop}}|
	/setvar key=instruct {{noop}}|
	
	//Button 12 - 01|
	/getentryfield file="Character Maker Combined NSFW GenRaw" 354|
	/setvar key=system {{pipe}}|
	/getentryfield file="Character Maker Combined NSFW GenRaw" 355|
	/setvar key=prompt {{pipe}}|
	/getentryfield file="Character Maker Combined NSFW GenRaw" 356|
	/setvar key=instruct {{pipe}}|
	
    /genraw lock=on name={{char}} 
	system="{{getvar::system}}"
{{getvar::prompt}}
{{getvar::instruct}}|

	/setvar key=t {{pipe}}|
	/re-replace replace="" find="/\./g" var=t| /setvar key=t {{pipe}}|
	/split var=t | 
	/setvar key=genState {{pipe}}|
    /addvar key=genState "Manually add to List"|
	/ife {: /test left=outputString right="" rule=eq:}|
		/then {: /addvar key=genState None| :}|
	/else {:/addvar key=genState Done|:}|
	
    /addvar key=genState Redo|

    /buttons labels={{getvar::genState}} Select the spell you want {{getname::fname}} to know.|

    /setvar key=selected_btn {{pipe}}|

    /ife {: /test left=selected_btn right="" rule=eq :}|
		/then {:/:"Character Maker V4.Flushvar"|| /echo Aborting | /abort:}|
    /elseif {: /test left={{getvar::selected_btn}} right="Manually add to List" rule=eq :}|
		/then {:
			
			/input rows=8 Add a spell that you want {{getvar::fname}} to know.|
			/setvar key=t {{pipe}}|
			/setvar key=genState Redo|
			/ife {: /test left=t right="" rule=eq :}|
				/then {:/:"Character Maker V4.Flushvar"|| /echo Aborting | /abort:}|
			/elseif {: /test left={{getvar::outputString}} right="" rule=neq :}|
            /then {:
                /addvar key=outputString ", {{getvar::t}}"|
            :}|
            /else {:
                /setvar key=outputString {{getvar::t}}|
            :}|
		:}|
	/elseif {: /test left={{getvar::selected_btn}} right=Done rule=eq :}|
		/then {::}|
	/elseif {: /test left={{getvar::selected_btn}} right=None rule=eq :}|
		/then {: /setvar key=outputString None :}|
	/elseif {: /test left={{getvar::selected_btn}} right=Redo rule=neq :}|
		/then {:
			/ife {: /test left={{getvar::outputString}} right="" rule=neq :}|
				/then {:
					/addvar key=outputString ", {{getvar::selected_btn}}"|
					/setvar key=genState Redo
				:}|
				/else {:
					/setvar key=outputString {{getvar::selected_btn}}|
					/setvar key=genState Redo
				:}|
		:}|
	/else  {: /setvar key=genState Redo :}|
	:}|
:}|
/setvar key=spelln {{getvar::outputString}}|

/wait 1|
/setvar key=spelld []|
/ife {: /test left=spelln right=None rule=neq :}|
	/then {:
		
		/split find="," var=spelln| /setvar key=spells {{pipe}}|
		
		/foreach var=spells {:
			/setvar key=genState Redo|
			/while left=genState right=Redo rule=eq {:
				/echo Generating {{item}}'s description.|
				/setvar key=genState []|
				
				/setvar key=system {{noop}}|
				/setvar key=prompt {{noop}}|
				/setvar key=instruct {{noop}}|
				
				//Button 12 - 02|
				/getentryfield file="Character Maker Combined NSFW GenRaw" 358|
				/setvar key=system {{pipe}}|
				/getentryfield file="Character Maker Combined NSFW GenRaw" 359|
				/setvar key=prompt {{pipe}}|
				/getentryfield file="Character Maker Combined NSFW GenRaw" 360|
				/setvar key=instruct {{pipe}}|
				
				/genraw lock=on name={{char}} 
				system="{{getvar::system}}"
{{getvar::prompt}}
{{getvar::instruct}}|
				
				
				
				
				/addvar key=genState {{pipe}}|
				/addvar key=genState Edit|  
				/addvar key=genState Redo|  
			
				/buttons labels={{getvar::genState}} Is this an accurate description of what the spell {{item}} does?|
			
				/setvar key=selected_btn {{pipe}}|
			
				/ife {: /test left=selected_btn right="" rule=eq :}|
					/then {:/:"Character Maker V4.Flushvar"|| /echo Aborting | /abort:}|
				/elseif {: /test left={{getvar::selected_btn}} right=Edit rule=eq :}|
					/then {:
						/getvar key=genState index=0 | /setvar key=t {{pipe}}|
						/input rows=8 default={{getvar::t}} Edit the spell {{item}}'s description.|
						/setvar key=selected_btn {{pipe}}|
						/ife {: /test left=selected_btn right="" rule=eq :}|
							/then {: /:"Character Maker V4.Flushvar"|| /echo Aborting | /abort :}
					:}|
			
				/elseif {: /test left={{getvar::selected_btn}} right=Redo rule=eq :}|
					/then {:
						/setvar key=genState Redo|
					:}|
			:}|
			/addvar key=spelld {{getvar::selected_btn}}|
		:}|
	:}|
/else {: /addvar key=spelld "{{getvar::fname}} have no spells." :}|




/setvar key=genState Redo|
/setvar key=outputString {{noop}}|

/while left=genState right=Redo rule=eq {:
	/echo Generating Abilities|
    /setvar key=genState []|  
	
	/setvar key=system {{noop}}|
	/setvar key=prompt {{noop}}|
	/setvar key=instruct {{noop}}|
	
	//Button 12 - 03|
	/getentryfield file="Character Maker Combined NSFW GenRaw" 362|
	/setvar key=system {{pipe}}|
	/getentryfield file="Character Maker Combined NSFW GenRaw" 363|
	/setvar key=prompt {{pipe}}|
	/getentryfield file="Character Maker Combined NSFW GenRaw" 364|
	/setvar key=instruct {{pipe}}|
	
    /genraw lock=on name={{char}} 
	system="{{getvar::system}}"
{{getvar::prompt}}
{{getvar::instruct}}|

	/setvar key=t {{pipe}}|
	/re-replace replace="" find="/\./g" var=t| /setvar key=t {{pipe}}|
	/split var=t | 
	/setvar key=genState {{pipe}}|
    /addvar key=genState "Manually add to List"|
	/ife {: /test left=outputString right="" rule=eq:}|
		/then {: /addvar key=genState None| :}|
	/else {:/addvar key=genState Done|:}|
    /addvar key=genState Redo|

    /buttons labels={{getvar::genState}} Select the ability you want {{getvar::fname}} to have.|

    /setvar key=selected_btn {{pipe}}|

    /ife {: /test left=selected_btn right="" rule=eq :}|
		/then {:/:"Character Maker V4.Flushvar"|| /echo Aborting | /abort:}|
    /elseif {: /test left={{getvar::selected_btn}} right="Manually add to List" rule=eq :}|
		/then {:
			
			/input rows=8 Add an Ability you want {{getvar::fname}} to have.|
			/setvar key=t {{pipe}}|
			/setvar key=genState Redo|
			/ife {: /test left=t right="" rule=eq :}|
				/then {:/:"Character Maker V4.Flushvar"|| /echo Aborting | /abort:}|
			/elseif {: /test left={{getvar::outputString}} right="" rule=neq :}|
            /then {:
                /addvar key=outputString ", {{getvar::t}}"|
            :}|
            /else {:
                /setvar key=outputString {{getvar::t}}|
            :}|
		:}|
	/elseif {: /test left={{getvar::selected_btn}} right=Done rule=eq :}|
		/then {::}|
	/elseif {: /test left={{getvar::selected_btn}} right=None rule=eq :}|
		/then {: /setvar key=outputString None :}|
	/elseif {: /test left={{getvar::selected_btn}} right=Redo rule=neq :}|
		/then {:
			/ife {: /test left={{getvar::outputString}} right="" rule=neq :}|
				/then {:
					/addvar key=outputString ", {{getvar::selected_btn}}"|
					/setvar key=genState Redo
				:}|
				/else {:
					/setvar key=outputString {{getvar::selected_btn}}|
					/setvar key=genState Redo
				:}|
		:}|
	/else  {: /setvar key=genState Redo :}|
	:}|
:}|
/setvar key=abilityn {{getvar::outputString}}|



/setvar key=abilityd []|
/wait 1|
/ife {: /test left=abilityn right=None rule=neq :}|
	/then {:
		
		/split find="," var=abilityn| /setvar key=spells {{pipe}}|
	
		/foreach var=spells {:
			/setvar key=genState Redo|
			
			/while left=genState right=Redo rule=eq {:
				/echo Generating {{item}}'s description.|
				/setvar key=genState []|  
				
				/setvar key=system {{noop}}|
				/setvar key=prompt {{noop}}|
				/setvar key=instruct {{noop}}|
				
				//Button 12 - 04|
				/getentryfield file="Character Maker Combined NSFW GenRaw" 366|
				/setvar key=system {{pipe}}|
				/getentryfield file="Character Maker Combined NSFW GenRaw" 367|
				/setvar key=prompt {{pipe}}|
				/getentryfield file="Character Maker Combined NSFW GenRaw" 368|
				/setvar key=instruct {{pipe}}|
				
				/genraw lock=on name={{char}} 
				system="{{getvar::system}}"
{{getvar::prompt}}
{{getvar::instruct}}|
				
				
				
				
				/addvar key=genState {{pipe}}|
				/addvar key=genState Edit|  
				/addvar key=genState Redo|  
			
				/buttons labels={{getvar::genState}} Is this an accurate description of the ability {{item}}.|
			
				/setvar key=selected_btn {{pipe}}|
			
				/ife {: /test left=selected_btn right="" rule=eq :}|
					/then {:/:"Character Maker V4.Flushvar"|| /echo Aborting | /abort:}|
				/elseif {: /test left={{getvar::selected_btn}} right=Edit rule=eq :}|
					/then {:
						/getvar key=genState index=0 | /setvar key=t {{pipe}}|
						/input rows=8 default={{getvar::t}} Edit the description of the ability {{item}}'s description.|
						/setvar key=selected_btn {{pipe}}|
						/ife {: /test left=selected_btn right="" rule=eq :}|
							/then {:/:"Character Maker V4.Flushvar"|| /echo Aborting | /abort:}|
					:}|
			
				/elseif {: /test left={{getvar::selected_btn}} right=Redo rule=eq :}|
					/then {:
						/setvar key=genState Redo|
					:}|
			:}|
		/addvar key=abilityd {{getvar::selected_btn}}|
		:}|
	:}|
/else {: /addvar key=abilityd "{{getvar::fname}} have no abilities.":}|

/setvar key=output "<h2 align='center'>{{getvar::catgen}}</h2>

Spells

"|
/len {{getvar::spelld}} | /setvar key=l {{pipe}}|
/foreach var=spelld {:
	/ife {: /test left={{index}} right=l rule=lt:}|
		/then {: /addvar key=output "{{item}}

"
	:}|
	/else {:/addvar key=output {{item}}:}|
:}|
/addvar key=output "Abilities

"|
/len {{getvar::abilityd}} | /setvar key=l {{pipe}}|
/foreach var=abilityd {:
	/ife {: /test left={{index}} right=l rule=lt:}|
		/then {: /addvar key=output "{{item}}

"
	:}|
	/else {:/addvar key=output {{item}}:}|
:}|
/message-edit message={{lastMessageId}} {{getvar::output}}